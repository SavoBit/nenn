{% extends "syntax_highlight.html" %}

{% block headerkludge %}
<nav class="breadcrumb" aria-label="breadcrumbs">
  <ul>
    <li><a href="{{ url('home') }}">Home</a></li>
    <li><a href="{{ url('exercises') }}">Exercises</a></li>
    <li class="is-active"><a href="#" aria-current="page">Command Injection</a></li>
  </ul>
</nav>
{% endblock %}

{% block content %}
<div class="tabs">
  <ul>
    <li class="is-active"><a href="#">No Protections</a></li>
    <li><a href="{{ url('shell-injection2') }}">Poor Protections</a></li>
    <li><a href="{{ url('shell-injection3') }}">Better?</a></li>
  </ul>
</div>

<div class="content">
  <p>Here's a WHOIS service. The output looks kind of familiar...</p>
  <p>Can you exploit this service to run malicious code?</p>
</div>

{% if result %}
<pre><code>{{ result }}</pre></code>
  <p><a href="{{ url('shell-injection') }}">search another</a></p>

  {% else %}
  <form action="{{ url('injection1') }}" method="POST">
    <div class="field">
      <div class="control">
        <input name="host" class="input" type="text" placeholder="domain">
      </div>
    </div>
    <div class="field">
      <div class="control">
        <button name="submit" class="button is-link">Submit</button>
      </div>
    </div>
  </form>

  <div class="section">
    <pre><code>
@require_http_methods(['POST'])
def injection1(request):
    host = request.POST.get('host')
    result = subprocess.run(
        'whois ' + host,
        stdout=subprocess.PIPE,
        stderr=subprocess.STDOUT,
        shell=True
    ).stdout

    return render(request, 'vulnerable/shell-injection.html', {'result': result})
  </pre></code>
  </div>

  {% endif %}

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  {% endblock %}
